# safe-rm

## 项目介绍
safe-rm 是一个增强的文件删除工具，旨在防止危险的 rm 命令误删系统关键文件。它通过拦截和验证删除操作，保护系统免受意外或恶意的文件删除。

## 问题场景
在 Linux 服务器运维实施过程中，误删除系统关键目录或重要数据目录可能导致严重后果：

1. **命令输入错误**
   - 误输入 `rm -rf /etc` 或 `rm -rf /*`
   - 可能导致系统崩溃或数据丢失

2. **权限配置不当**
   - 非授权用户获得高权限
   - 执行破坏性删除操作

3. **人为失误**
   - 疲劳或紧急操作时的误操作
   - 未仔细检查命令

## 主要特性
- 防止删除根目录（/）及其直接内容
- 保护系统关键目录（/bin、/etc、/usr 等）
- 对数据目录（/root、/home、/data 等）进行特权控制
- 详细的操作日志记录
- 彩色输出和友好的提示信息

## 默认保护目录

### 系统关键目录
以下目录默认受到保护，禁止删除：
```
/          # 根目录，删除会导致整个系统不可用
/bin       # 核心系统二进制文件
/sbin      # 系统管理命令
/lib       # 系统动态链接库
/lib64     # 64位系统动态链接库
/usr       # 系统二进制文件和共享资源
/var       # 系统日志和运行时数据
/etc       # 系统配置文件
/boot      # 内核和引导加载程序
/proc      # 虚拟文件系统
/sys       # 内核设备和驱动信息
/dev       # 设备文件
/run       # 运行时数据
/srv       # 服务数据
/opt       # 可选软件包
/media     # 可移动设备挂载点
/mnt       # 临时挂载点
/tmp       # 临时文件
```

### 数据目录
以下目录需要特权才能删除：
```
/root      # root用户目录
/home      # 用户主目录
/data      # 数据存储目录
```

## 准备工作

### 系统要求
- Linux 系统（支持CentOS、Ubuntu、Debian、国产麒麟等）
- root 权限（用于安装）
- 至少50MB可用空间

### 环境检查
1. 确认系统环境：
   - 操作系统类型
   - root或sudo权限
   - 可用磁盘空间

2. 安装依赖：
   - tar（解压工具）
   - bash（shell环境）
   - rsyslog（日志服务，可选）

3. 建议操作：
   - 备份重要目录
   - 在测试环境验证

## 安装说明

### 安装步骤
1. 下载并解压安装包：
   ```bash
   # 下载安装包
   wget https://github.com/freemankevin/safe-rm/releases/download/release-20250519/safe-rm.tar.gz
   
   # 解压文件
   tar xf safe-rm.tar.gz
   ```

2. 运行安装脚本：
   ```bash
   sudo bash install.sh
   source /etc/profile  # 刷新环境变量
   ```

### 卸载方法
```bash
sudo bash install.sh --uninstall
source /etc/profile  # 刷新环境变量
```

## 使用说明

### 基本用法
safe-rm 完全兼容原生 rm 命令的语法：
```bash
rm [选项]... [文件]...
```

### 常用选项
- `-f, --force`: 强制删除文件，忽略不存在的文件
- `-r, -R, --recursive`: 递归删除目录及其内容
- `-i`: 每次删除前提示
- `-v, --verbose`: 显示详细操作信息

### 特权选项
- `--force`: 允许删除数据目录
- `--verify=true`: 确认删除操作
- `--user=root`: 以root用户身份执行（仅用于特定目录）

### 使用示例
1. 删除普通文件：
   ```bash
   rm file.txt
   ```

2. 递归删除目录：
   ```bash
   rm -rf /home/user/test
   ```

3. 删除数据目录（需要特权）：
   ```bash
   rm -rf /data/ --force --verify=true
   ```

## 配置说明

### 配置文件
配置文件在安装时自动生成，用于自定义 safe-rm 的行为：

```bash
#!/bin/bash
# safe-rm 配置文件
# 可自定义受保护目录和日志设置

# 额外受保护的系统目录
EXTRA_PROTECTED_DIRS=()

# 额外用户数据目录
EXTRA_USER_DIRS=()

# 日志文件路径
LOGFILE="/var/log/rm_protect.log"
```

### 日志记录
所有删除操作都会被记录到日志文件中，包含以下信息：
- 操作时间戳
- 操作状态（成功/失败）
- 执行的命令
- 操作的目录

## 常见问题

1. **安装权限问题**
   - 问题：安装时提示"Permission denied"
   - 解决：使用root权限或sudo运行安装脚本

2. **添加保护目录**
   - 问题：如何添加新的受保护目录
   - 解决：在配置文件中的EXTRA_PROTECTED_DIRS中添加

3. **日志问题**
   - 问题：日志文件未生成
   - 解决：检查日志路径权限和目录是否存在

4. **误拦截问题**
   - 问题：合法删除操作被拦截
   - 解决：检查配置或临时禁用特定目录的保护

## 注意事项
- 某些操作可能需要 root 权限
- 建议定期检查日志文件
- 重要数据建议先备份再删除
- 在生产环境部署前先在测试环境验证

## 贡献指南
欢迎提交问题报告和改进建议！请访问我们的 GitHub 仓库参与项目开发。

## 许可证
本项目采用 Apache-2.0 许可证 - 详见 [LICENSE](LICENSE) 文件